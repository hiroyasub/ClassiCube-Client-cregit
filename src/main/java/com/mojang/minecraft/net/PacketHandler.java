begin_unit|revision:1.0.0;language:Java;cregit-version:0.0.1
begin_package
package|package
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|net
package|;
end_package

begin_import
import|import
name|java
operator|.
name|awt
operator|.
name|image
operator|.
name|BufferedImage
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayInputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|ByteArrayOutputStream
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|File
import|;
end_import

begin_import
import|import
name|java
operator|.
name|io
operator|.
name|IOException
import|;
end_import

begin_import
import|import
name|java
operator|.
name|net
operator|.
name|URL
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Collections
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|HashSet
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|List
import|;
end_import

begin_import
import|import
name|java
operator|.
name|util
operator|.
name|Set
import|;
end_import

begin_import
import|import
name|javax
operator|.
name|imageio
operator|.
name|ImageIO
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|GameSettings
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|HotKeyData
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|Minecraft
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|PlayerListComparator
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|PlayerListNameData
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|SelectionBoxData
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|SessionData
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|gui
operator|.
name|ErrorScreen
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|gui
operator|.
name|HUDScreen
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|level
operator|.
name|Level
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|level
operator|.
name|LevelLoader
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|level
operator|.
name|tile
operator|.
name|Block
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|level
operator|.
name|tile
operator|.
name|BlockID
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|mob
operator|.
name|HumanoidMob
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|model
operator|.
name|Model
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|model
operator|.
name|ModelManager
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|minecraft
operator|.
name|physics
operator|.
name|CustomAABB
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|util
operator|.
name|ColorCache
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|util
operator|.
name|LogUtil
import|;
end_import

begin_import
import|import
name|com
operator|.
name|mojang
operator|.
name|util
operator|.
name|MathHelper
import|;
end_import

begin_import
import|import
name|com
operator|.
name|oyasunadev
operator|.
name|mcraft
operator|.
name|client
operator|.
name|util
operator|.
name|Constants
import|;
end_import

begin_comment
comment|// This class is responsible for responding to individual packets coming from the client.
end_comment

begin_comment
comment|// It also handles CPE Negotiation process.
end_comment

begin_class
specifier|public
specifier|final
class|class
name|PacketHandler
block|{
specifier|private
specifier|final
name|Set
argument_list|<
name|ProtocolExtension
argument_list|>
name|enabledExtensions
init|=
operator|new
name|HashSet
argument_list|<>
argument_list|()
decl_stmt|;
specifier|private
name|int
name|extEntriesExpected
decl_stmt|,
name|extEntriesReceived
decl_stmt|;
specifier|private
name|boolean
name|receivedExtInfo
decl_stmt|;
specifier|private
specifier|final
name|Minecraft
name|minecraft
decl_stmt|;
specifier|public
name|boolean
name|isLoadingLevel
decl_stmt|;
comment|// This object is used to store the level object while it's being loaded.
comment|// Packets that modify can modify the level before it loaded (like ENV_SET_COLOR)
comment|// should modify this object instead of "minecraft.level" while isLoadingLevel is true.
specifier|private
name|Level
name|newLevel
decl_stmt|;
specifier|public
name|PacketHandler
parameter_list|(
name|Minecraft
name|minecraft
parameter_list|)
block|{
name|this
operator|.
name|minecraft
operator|=
name|minecraft
expr_stmt|;
name|setLoadingLevel
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
specifier|public
name|void
name|setLoadingLevel
parameter_list|(
name|boolean
name|value
parameter_list|)
block|{
if|if
condition|(
name|value
operator|&&
operator|!
name|isLoadingLevel
condition|)
block|{
name|newLevel
operator|=
operator|new
name|Level
argument_list|()
expr_stmt|;
block|}
if|else if
condition|(
operator|!
name|value
operator|&&
name|isLoadingLevel
condition|)
block|{
name|newLevel
operator|=
literal|null
expr_stmt|;
block|}
name|isLoadingLevel
operator|=
name|value
expr_stmt|;
block|}
comment|// return true if more packets should be read; return false if that's it
specifier|public
name|boolean
name|handlePacket
parameter_list|(
name|NetworkManager
name|networkHandler
parameter_list|)
throws|throws
name|IOException
block|{
name|networkHandler
operator|.
name|in
operator|.
name|flip
argument_list|()
expr_stmt|;
name|byte
name|packetId
init|=
name|networkHandler
operator|.
name|in
operator|.
name|get
argument_list|(
literal|0
argument_list|)
decl_stmt|;
if|if
condition|(
name|packetId
operator|<
literal|0
operator|||
name|packetId
operator|>
name|PacketType
operator|.
name|packets
operator|.
name|length
operator|-
literal|1
condition|)
block|{
throw|throw
operator|new
name|IOException
argument_list|(
literal|"Unknown packet ID received: "
operator|+
name|packetId
argument_list|)
throw|;
block|}
name|PacketType
name|packetType
init|=
name|PacketType
operator|.
name|packets
index|[
name|packetId
index|]
decl_stmt|;
if|if
condition|(
name|networkHandler
operator|.
name|in
operator|.
name|remaining
argument_list|()
operator|<
name|packetType
operator|.
name|length
operator|+
literal|1
condition|)
block|{
comment|// No more packets left to read
name|networkHandler
operator|.
name|in
operator|.
name|compact
argument_list|()
expr_stmt|;
return|return
literal|false
return|;
block|}
name|networkHandler
operator|.
name|in
operator|.
name|get
argument_list|()
expr_stmt|;
name|Object
index|[]
name|packetParams
init|=
operator|new
name|Object
index|[
name|packetType
operator|.
name|params
operator|.
name|length
index|]
decl_stmt|;
for|for
control|(
name|int
name|i
init|=
literal|0
init|;
name|i
operator|<
name|packetParams
operator|.
name|length
condition|;
operator|++
name|i
control|)
block|{
name|packetParams
index|[
name|i
index|]
operator|=
name|networkHandler
operator|.
name|readObject
argument_list|(
name|packetType
operator|.
name|params
index|[
name|i
index|]
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|networkHandler
operator|.
name|isConnected
argument_list|()
condition|)
block|{
if|if
condition|(
name|packetType
operator|.
name|opcode
operator|>
name|PacketType
operator|.
name|UPDATE_PLAYER_TYPE
operator|.
name|opcode
condition|)
block|{
name|handleExtendedPacket
argument_list|(
name|networkHandler
argument_list|,
name|packetType
argument_list|,
name|packetParams
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|handleStandardPacket
argument_list|(
name|networkHandler
argument_list|,
name|packetType
argument_list|,
name|packetParams
argument_list|)
expr_stmt|;
block|}
block|}
if|if
condition|(
name|networkHandler
operator|.
name|isConnected
argument_list|()
condition|)
block|{
name|networkHandler
operator|.
name|in
operator|.
name|compact
argument_list|()
expr_stmt|;
return|return
literal|true
return|;
block|}
else|else
block|{
comment|// We've been disconnected!
return|return
literal|false
return|;
block|}
block|}
specifier|private
name|void
name|handleStandardPacket
parameter_list|(
name|NetworkManager
name|networkManager
parameter_list|,
name|PacketType
name|packetType
parameter_list|,
name|Object
index|[]
name|packetParams
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|IDENTIFICATION
condition|)
block|{
name|String
name|name
init|=
name|packetParams
index|[
literal|1
index|]
operator|.
name|toString
argument_list|()
decl_stmt|;
name|String
name|motd
init|=
name|packetParams
index|[
literal|2
index|]
operator|.
name|toString
argument_list|()
decl_stmt|;
name|minecraft
operator|.
name|progressBar
operator|.
name|setTitle
argument_list|(
name|name
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|progressBar
operator|.
name|setText
argument_list|(
name|motd
argument_list|)
expr_stmt|;
comment|// Read WoM-style hack control flags
comment|//TODO: if(!isExtEnabled(ProtocolExtension.HACK_CONTROL)){ ... }
name|minecraft
operator|.
name|womConfig
operator|.
name|readHax
argument_list|(
name|name
argument_list|,
name|motd
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|receivedExtInfo
condition|)
block|{
comment|// Only process WoM-style "cfg" command if CPE is not enabled
name|minecraft
operator|.
name|womConfig
operator|.
name|readCfg
argument_list|(
name|motd
argument_list|)
expr_stmt|;
block|}
name|minecraft
operator|.
name|player
operator|.
name|userType
operator|=
operator|(
name|Byte
operator|)
name|packetParams
index|[
literal|3
index|]
expr_stmt|;
name|setLoadingLevel
argument_list|(
literal|true
argument_list|)
expr_stmt|;
if|if
condition|(
name|minecraft
operator|.
name|womConfig
operator|.
name|isEnabled
argument_list|()
operator|&&
name|minecraft
operator|.
name|womConfig
operator|.
name|hasKey
argument_list|(
literal|"server.sendwomid"
argument_list|)
condition|)
block|{
name|String
name|womIdCmd
init|=
literal|"/womid ClassiCube"
operator|+
name|Constants
operator|.
name|CLASSICUBE_VERSION
decl_stmt|;
name|networkManager
operator|.
name|send
argument_list|(
name|PacketType
operator|.
name|CHAT_MESSAGE
argument_list|,
operator|-
literal|1
argument_list|,
name|womIdCmd
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|LEVEL_INIT
condition|)
block|{
name|minecraft
operator|.
name|selectionBoxes
operator|.
name|clear
argument_list|()
expr_stmt|;
name|minecraft
operator|.
name|setLevel
argument_list|(
literal|null
argument_list|)
expr_stmt|;
name|networkManager
operator|.
name|levelData
operator|=
operator|new
name|ByteArrayOutputStream
argument_list|()
expr_stmt|;
name|setLoadingLevel
argument_list|(
literal|true
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|LEVEL_DATA
condition|)
block|{
name|short
name|chunkLength
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
index|[]
name|chunkData
init|=
operator|(
name|byte
index|[]
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|byte
name|percentComplete
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|networkManager
operator|.
name|minecraft
operator|.
name|progressBar
operator|.
name|setProgress
argument_list|(
name|percentComplete
argument_list|)
expr_stmt|;
name|networkManager
operator|.
name|levelData
operator|.
name|write
argument_list|(
name|chunkData
argument_list|,
literal|0
argument_list|,
name|chunkLength
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|LEVEL_FINALIZE
condition|)
block|{
name|networkManager
operator|.
name|minecraft
operator|.
name|progressBar
operator|.
name|setProgress
argument_list|(
literal|100
argument_list|)
expr_stmt|;
try|try
block|{
name|networkManager
operator|.
name|levelData
operator|.
name|close
argument_list|()
expr_stmt|;
block|}
catch|catch
parameter_list|(
name|IOException
name|ex
parameter_list|)
block|{
name|LogUtil
operator|.
name|logError
argument_list|(
literal|"Error receiving level data."
argument_list|)
expr_stmt|;
throw|throw
name|ex
throw|;
comment|// We are in an inconsistent state; abort!
block|}
name|byte
index|[]
name|decompressedStream
init|=
name|LevelLoader
operator|.
name|decompress
argument_list|(
operator|new
name|ByteArrayInputStream
argument_list|(
name|networkManager
operator|.
name|levelData
operator|.
name|toByteArray
argument_list|()
argument_list|)
argument_list|)
decl_stmt|;
name|networkManager
operator|.
name|levelData
operator|=
literal|null
expr_stmt|;
name|short
name|xSize
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|short
name|ySize
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|short
name|zSize
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|newLevel
operator|.
name|setNetworkMode
argument_list|(
literal|true
argument_list|)
expr_stmt|;
name|newLevel
operator|.
name|setData
argument_list|(
name|xSize
argument_list|,
name|ySize
argument_list|,
name|zSize
argument_list|,
name|decompressedStream
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|setLevel
argument_list|(
name|newLevel
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|isConnecting
operator|=
literal|false
expr_stmt|;
name|networkManager
operator|.
name|levelLoaded
operator|=
literal|true
expr_stmt|;
name|setLoadingLevel
argument_list|(
literal|false
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|BLOCK_CHANGE
condition|)
block|{
if|if
condition|(
name|minecraft
operator|.
name|level
operator|!=
literal|null
condition|)
block|{
name|networkManager
operator|.
name|minecraft
operator|.
name|level
operator|.
name|netSetTile
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
argument_list|,
operator|(
name|short
operator|)
name|packetParams
index|[
literal|1
index|]
argument_list|,
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
argument_list|,
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
comment|// else: no level is loaded, ignore block change
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|SPAWN_PLAYER
condition|)
block|{
if|if
condition|(
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|EXT_PLAYER_LIST_2
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server tried to send SPAWN_PLAYER even though ExtPlayerList version 2 is in use."
argument_list|)
expr_stmt|;
return|return;
block|}
name|byte
name|newPlayerId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|newPlayerName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|short
name|newPlayerX
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|short
name|newPlayerY
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|short
name|newPlayerZ
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|4
index|]
decl_stmt|;
name|byte
name|newPlayerXRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|5
index|]
decl_stmt|;
name|byte
name|newPlayerYRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|6
index|]
decl_stmt|;
name|handleSpawnPlayer
argument_list|(
name|networkManager
argument_list|,
name|newPlayerName
argument_list|,
name|newPlayerId
argument_list|,
name|newPlayerX
argument_list|,
name|newPlayerY
argument_list|,
name|newPlayerZ
argument_list|,
name|newPlayerXRot
argument_list|,
name|newPlayerYRot
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|POSITION_ROTATION
condition|)
block|{
name|byte
name|playerId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|short
name|newX
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|short
name|newY
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|short
name|newZ
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|byte
name|newXRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|4
index|]
decl_stmt|;
name|byte
name|newYRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|5
index|]
decl_stmt|;
if|if
condition|(
name|playerId
operator|<
literal|0
condition|)
block|{
comment|// Move self
name|minecraft
operator|.
name|player
operator|.
name|moveTo
argument_list|(
name|newX
operator|/
literal|32F
argument_list|,
name|newY
operator|/
literal|32F
argument_list|,
name|newZ
operator|/
literal|32F
argument_list|,
name|newXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Move another player
name|newXRot
operator|=
operator|(
name|byte
operator|)
operator|(
name|newXRot
operator|+
literal|128
operator|)
expr_stmt|;
name|newY
operator|=
operator|(
name|short
operator|)
operator|(
name|newY
operator|-
literal|22
operator|)
expr_stmt|;
name|NetworkPlayer
name|networkPlayer
init|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerId
argument_list|)
decl_stmt|;
if|if
condition|(
name|networkPlayer
operator|!=
literal|null
condition|)
block|{
name|networkPlayer
operator|.
name|teleport
argument_list|(
name|newX
argument_list|,
name|newY
argument_list|,
name|newZ
argument_list|,
name|newYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
expr_stmt|;
block|}
comment|// else: unknown player ID given, ignore it.
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|POSITION_ROTATION_UPDATE
condition|)
block|{
name|byte
name|playerId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
name|deltaX
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|byte
name|deltaY
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|byte
name|deltaZ
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|byte
name|newXRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|4
index|]
decl_stmt|;
name|byte
name|newYRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|5
index|]
decl_stmt|;
if|if
condition|(
name|playerId
operator|>=
literal|0
condition|)
block|{
name|newXRot
operator|=
operator|(
name|byte
operator|)
operator|(
name|newXRot
operator|+
literal|128
operator|)
expr_stmt|;
name|NetworkPlayer
name|networkPlayerInstance
init|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerId
argument_list|)
decl_stmt|;
if|if
condition|(
name|networkPlayerInstance
operator|!=
literal|null
condition|)
block|{
name|networkPlayerInstance
operator|.
name|queue
argument_list|(
name|deltaX
argument_list|,
name|deltaY
argument_list|,
name|deltaZ
argument_list|,
name|newYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
expr_stmt|;
block|}
block|}
comment|// else: This packet cannot be applied to self, and is ignored if playerId<0
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|ROTATION_UPDATE
condition|)
block|{
name|byte
name|playerID
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
name|newXRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|byte
name|newYRot
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
if|if
condition|(
name|playerID
operator|>=
literal|0
condition|)
block|{
name|newXRot
operator|=
operator|(
name|byte
operator|)
operator|(
name|newXRot
operator|+
literal|128
operator|)
expr_stmt|;
name|NetworkPlayer
name|networkPlayerInstance
init|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerID
argument_list|)
decl_stmt|;
if|if
condition|(
name|networkPlayerInstance
operator|!=
literal|null
condition|)
block|{
name|networkPlayerInstance
operator|.
name|queue
argument_list|(
name|newYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
expr_stmt|;
block|}
block|}
comment|// else: This packet cannot be applied to self, and is ignored if playerId<0
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|POSITION_UPDATE
condition|)
block|{
name|byte
name|playerID
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|NetworkPlayer
name|networkPlayerInstance
init|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerID
argument_list|)
decl_stmt|;
if|if
condition|(
name|playerID
operator|>=
literal|0
operator|&&
name|networkPlayerInstance
operator|!=
literal|null
condition|)
block|{
name|networkPlayerInstance
operator|.
name|queue
argument_list|(
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
argument_list|,
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
argument_list|,
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|3
index|]
argument_list|)
expr_stmt|;
block|}
comment|// else: This packet cannot be applied to self, and is ignored if playerId<0
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|DESPAWN_PLAYER
condition|)
block|{
name|byte
name|playerID
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|NetworkPlayer
name|targetPlayer
init|=
name|networkManager
operator|.
name|removePlayer
argument_list|(
name|playerID
argument_list|)
decl_stmt|;
if|if
condition|(
name|playerID
operator|>=
literal|0
operator|&&
name|targetPlayer
operator|!=
literal|null
condition|)
block|{
name|targetPlayer
operator|.
name|unloadSkin
argument_list|(
name|minecraft
operator|.
name|textureManager
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|level
operator|.
name|removeEntity
argument_list|(
name|targetPlayer
argument_list|)
expr_stmt|;
block|}
comment|// else: This packet cannot be applied to self, and is ignored if playerId<0
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|CHAT_MESSAGE
condition|)
block|{
name|byte
name|messageType
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|message
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
if|if
condition|(
name|messageType
operator|>
literal|0
operator|&&
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|MESSAGE_TYPES
argument_list|)
condition|)
block|{
comment|// MESSAGE_TYPES CPE
switch|switch
condition|(
name|messageType
condition|)
block|{
case|case
literal|1
case|:
name|HUDScreen
operator|.
name|ServerName
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|2
case|:
name|HUDScreen
operator|.
name|Compass
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|3
case|:
name|HUDScreen
operator|.
name|UserDetail
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|11
case|:
name|HUDScreen
operator|.
name|BottomRight1
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|12
case|:
name|HUDScreen
operator|.
name|BottomRight2
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|13
case|:
name|HUDScreen
operator|.
name|BottomRight3
operator|=
name|message
expr_stmt|;
break|break;
case|case
literal|100
case|:
name|HUDScreen
operator|.
name|AnnouncementTimer
operator|=
name|System
operator|.
name|currentTimeMillis
argument_list|()
expr_stmt|;
name|HUDScreen
operator|.
name|Announcement
operator|=
name|message
expr_stmt|;
break|break;
default|default:
comment|// unknown MessageType: stick it into regular chat box
name|minecraft
operator|.
name|hud
operator|.
name|addChat
argument_list|(
name|message
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|else if
condition|(
name|messageType
operator|<
literal|0
operator|&&
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|MESSAGE_TYPES
argument_list|)
condition|)
block|{
comment|// For compatibility with vanilla Minecraft: negative ID colors a message yellow
name|minecraft
operator|.
name|hud
operator|.
name|addChat
argument_list|(
literal|"&e"
operator|+
name|message
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Regular chat
name|minecraft
operator|.
name|hud
operator|.
name|addChat
argument_list|(
name|message
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|DISCONNECT
condition|)
block|{
name|setLoadingLevel
argument_list|(
literal|false
argument_list|)
expr_stmt|;
comment|// Reset this, in case we get kicked while changing levels.
name|networkManager
operator|.
name|close
argument_list|()
expr_stmt|;
name|minecraft
operator|.
name|setCurrentScreen
argument_list|(
operator|new
name|ErrorScreen
argument_list|(
literal|"Connection lost"
argument_list|,
operator|(
name|String
operator|)
name|packetParams
index|[
literal|0
index|]
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|UPDATE_PLAYER_TYPE
condition|)
block|{
name|minecraft
operator|.
name|player
operator|.
name|userType
operator|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
expr_stmt|;
block|}
block|}
specifier|private
name|void
name|handleExtendedPacket
parameter_list|(
name|NetworkManager
name|networkManager
parameter_list|,
name|PacketType
name|packetType
parameter_list|,
name|Object
index|[]
name|packetParams
parameter_list|)
throws|throws
name|IOException
block|{
if|if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_INFO
condition|)
block|{
if|if
condition|(
name|receivedExtInfo
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Received multiple ExtInfo packets! Only one was expected."
argument_list|)
expr_stmt|;
block|}
name|receivedExtInfo
operator|=
literal|true
expr_stmt|;
name|String
name|appName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|short
name|extensionCount
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|LogUtil
operator|.
name|logInfo
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Connecting to AppName \"%s\" with ExtensionCount %d"
argument_list|,
name|appName
argument_list|,
name|extensionCount
argument_list|)
argument_list|)
expr_stmt|;
name|extEntriesExpected
operator|=
name|extensionCount
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_ENTRY
condition|)
block|{
name|extEntriesReceived
operator|++
expr_stmt|;
name|String
name|extName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|int
name|version
init|=
operator|(
name|int
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
if|if
condition|(
name|extEntriesReceived
operator|>
name|extEntriesExpected
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Expected %d ExtEntries but received too many (%d)! "
operator|+
literal|"This ext will be ignored: %s with version %d"
argument_list|,
name|extEntriesExpected
argument_list|,
name|extEntriesReceived
argument_list|,
name|extName
argument_list|,
name|version
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|ProtocolExtension
name|serverExt
init|=
operator|new
name|ProtocolExtension
argument_list|(
name|extName
argument_list|,
name|version
argument_list|)
decl_stmt|;
name|LogUtil
operator|.
name|logInfo
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Receiving ext: %s with version: %d"
argument_list|,
name|serverExt
operator|.
name|name
argument_list|,
name|serverExt
operator|.
name|version
argument_list|)
argument_list|)
expr_stmt|;
if|if
condition|(
name|ProtocolExtension
operator|.
name|isSupported
argument_list|(
name|serverExt
argument_list|)
condition|)
block|{
name|enableExtension
argument_list|(
name|serverExt
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|extEntriesExpected
operator|==
name|extEntriesReceived
condition|)
block|{
name|ProtocolExtension
index|[]
name|enabledExtList
init|=
name|listEnabledExtensions
argument_list|()
decl_stmt|;
name|LogUtil
operator|.
name|logInfo
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Sending list of mutually-supported CPE extensions (%d)"
argument_list|,
name|enabledExtList
operator|.
name|length
argument_list|)
argument_list|)
expr_stmt|;
name|Object
index|[]
name|toSendParams
init|=
operator|new
name|Object
index|[]
block|{
name|Constants
operator|.
name|CLIENT_NAME
block|,
operator|(
name|short
operator|)
name|enabledExtList
operator|.
name|length
block|}
decl_stmt|;
name|networkManager
operator|.
name|send
argument_list|(
name|PacketType
operator|.
name|EXT_INFO
argument_list|,
name|toSendParams
argument_list|)
expr_stmt|;
for|for
control|(
name|ProtocolExtension
name|ext
range|:
name|enabledExtList
control|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
name|String
operator|.
name|format
argument_list|(
literal|"Sending ext: %s with version: %d"
argument_list|,
name|ext
operator|.
name|name
argument_list|,
name|ext
operator|.
name|version
argument_list|)
argument_list|)
expr_stmt|;
name|toSendParams
operator|=
operator|new
name|Object
index|[]
block|{
name|ext
operator|.
name|name
block|,
name|ext
operator|.
name|version
block|}
expr_stmt|;
name|networkManager
operator|.
name|send
argument_list|(
name|PacketType
operator|.
name|EXT_ENTRY
argument_list|,
name|toSendParams
argument_list|)
expr_stmt|;
block|}
block|}
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|SELECTION_CUBOID
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|SELECTION_CUBOID
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: SelectionCuboid"
argument_list|)
expr_stmt|;
block|}
name|Level
name|level
init|=
name|minecraft
operator|.
name|level
decl_stmt|;
name|byte
name|selectionId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|selectionName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
comment|// Selection coordinates must be clamped to map boundaries.
name|int
name|x1
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
argument_list|,
literal|0
argument_list|,
name|level
operator|.
name|width
argument_list|)
decl_stmt|;
name|int
name|y1
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
argument_list|,
literal|0
argument_list|,
name|level
operator|.
name|height
argument_list|)
decl_stmt|;
name|int
name|z1
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|4
index|]
argument_list|,
literal|0
argument_list|,
name|level
operator|.
name|length
argument_list|)
decl_stmt|;
comment|// Max values for coordinates may not exceed map dimensions.
comment|// They also cannot be lower than min values.
name|int
name|x2
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|5
index|]
argument_list|,
name|x1
argument_list|,
name|level
operator|.
name|width
argument_list|)
decl_stmt|;
name|int
name|y2
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|6
index|]
argument_list|,
name|y1
argument_list|,
name|level
operator|.
name|height
argument_list|)
decl_stmt|;
name|int
name|z2
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|7
index|]
argument_list|,
name|z1
argument_list|,
name|level
operator|.
name|length
argument_list|)
decl_stmt|;
comment|// Color components must be clamped to valid range (0-255)
name|int
name|r
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|8
index|]
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
decl_stmt|;
name|int
name|g
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|9
index|]
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
decl_stmt|;
name|int
name|b
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|10
index|]
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
decl_stmt|;
name|int
name|a
init|=
name|MathHelper
operator|.
name|clamp
argument_list|(
operator|(
name|short
operator|)
name|packetParams
index|[
literal|11
index|]
argument_list|,
literal|0
argument_list|,
literal|255
argument_list|)
decl_stmt|;
name|SelectionBoxData
name|data
init|=
operator|new
name|SelectionBoxData
argument_list|(
name|selectionId
argument_list|,
name|selectionName
argument_list|,
operator|new
name|ColorCache
argument_list|(
name|r
operator|/
literal|255F
argument_list|,
name|g
operator|/
literal|255F
argument_list|,
name|b
operator|/
literal|255F
argument_list|,
name|a
operator|/
literal|255F
argument_list|)
argument_list|,
operator|new
name|CustomAABB
argument_list|(
name|x1
argument_list|,
name|y1
argument_list|,
name|z1
argument_list|,
name|x2
argument_list|,
name|y2
argument_list|,
name|z2
argument_list|)
argument_list|)
decl_stmt|;
comment|// If a cuboid with the same ID already exists, it will be replaced.
name|minecraft
operator|.
name|selectionBoxes
operator|.
name|put
argument_list|(
name|selectionId
argument_list|,
name|data
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|REMOVE_SELECTION_CUBOID
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|SELECTION_CUBOID
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: SelectionCuboid"
argument_list|)
expr_stmt|;
block|}
name|byte
name|selectionId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
if|if
condition|(
name|minecraft
operator|.
name|selectionBoxes
operator|.
name|remove
argument_list|(
name|selectionId
argument_list|)
operator|==
literal|null
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Attempting to remove selection with unknown id "
operator|+
name|selectionId
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|ENV_SET_COLOR
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|ENV_COLORS
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: EnvColors"
argument_list|)
expr_stmt|;
block|}
name|byte
name|envVariable
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|int
name|r
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|int
name|g
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|int
name|b
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
comment|// If R, G, or B is out-of-range, we should reset the color to default.
name|boolean
name|doReset
init|=
operator|(
name|r
operator|<
literal|0
operator|||
name|r
operator|>
literal|255
operator|||
name|g
operator|<
literal|0
operator|||
name|g
operator|>
literal|255
operator|||
name|b
operator|<
literal|0
operator|||
name|b
operator|>
literal|255
operator|)
decl_stmt|;
name|int
name|dec
init|=
operator|(
name|r
operator|&
literal|0x0ff
operator|)
operator|<<
literal|16
operator||
operator|(
name|g
operator|&
literal|0x0ff
operator|)
operator|<<
literal|8
operator||
name|b
operator|&
literal|0x0ff
decl_stmt|;
comment|// Don't mess with "minecraft.level" if we're still in the process of loading a level.
name|Level
name|level
decl_stmt|;
if|if
condition|(
name|isLoadingLevel
condition|)
block|{
name|level
operator|=
name|newLevel
expr_stmt|;
block|}
else|else
block|{
name|level
operator|=
name|minecraft
operator|.
name|level
expr_stmt|;
block|}
switch|switch
condition|(
name|envVariable
condition|)
block|{
case|case
literal|0
case|:
comment|// sky
if|if
condition|(
name|doReset
condition|)
block|{
name|level
operator|.
name|skyColor
operator|=
name|Level
operator|.
name|DEFAULT_SKY_COLOR
expr_stmt|;
block|}
else|else
block|{
name|level
operator|.
name|skyColor
operator|=
name|dec
expr_stmt|;
block|}
break|break;
case|case
literal|1
case|:
comment|// cloud
if|if
condition|(
name|doReset
condition|)
block|{
name|level
operator|.
name|cloudColor
operator|=
name|Level
operator|.
name|DEFAULT_CLOUD_COLOR
expr_stmt|;
block|}
else|else
block|{
name|level
operator|.
name|cloudColor
operator|=
name|dec
expr_stmt|;
block|}
break|break;
case|case
literal|2
case|:
comment|// fog
if|if
condition|(
name|doReset
condition|)
block|{
name|level
operator|.
name|fogColor
operator|=
name|Level
operator|.
name|DEFAULT_FOG_COLOR
expr_stmt|;
block|}
else|else
block|{
name|level
operator|.
name|fogColor
operator|=
name|dec
expr_stmt|;
block|}
break|break;
case|case
literal|3
case|:
comment|// ambient light
if|if
condition|(
name|doReset
condition|)
block|{
name|level
operator|.
name|customShadowColor
operator|=
literal|null
expr_stmt|;
block|}
else|else
block|{
name|level
operator|.
name|customShadowColor
operator|=
operator|new
name|ColorCache
argument_list|(
name|r
operator|/
literal|255F
argument_list|,
name|g
operator|/
literal|255F
argument_list|,
name|b
operator|/
literal|255F
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|isLoadingLevel
condition|)
block|{
name|minecraft
operator|.
name|levelRenderer
operator|.
name|refresh
argument_list|()
expr_stmt|;
block|}
break|break;
case|case
literal|4
case|:
comment|// diffuse color
if|if
condition|(
name|doReset
condition|)
block|{
name|level
operator|.
name|customLightColor
operator|=
literal|null
expr_stmt|;
block|}
else|else
block|{
name|level
operator|.
name|customLightColor
operator|=
operator|new
name|ColorCache
argument_list|(
name|r
operator|/
literal|255F
argument_list|,
name|g
operator|/
literal|255F
argument_list|,
name|b
operator|/
literal|255F
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|isLoadingLevel
condition|)
block|{
name|minecraft
operator|.
name|levelRenderer
operator|.
name|refresh
argument_list|()
expr_stmt|;
block|}
break|break;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|ENV_SET_MAP_APPEARANCE
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|ENV_MAP_APPEARANCE
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: EnvMapAppearance"
argument_list|)
expr_stmt|;
block|}
name|String
name|textureUrl
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
name|sideBlock
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|byte
name|edgeBlock
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|short
name|sideLevel
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
comment|//LogUtil.logInfo("ENV_SET_MAP_APPEARANCE(" + textureUrl + "," + sideBlock + "," + edgeBlock + "," + sideLevel + ")");
if|if
condition|(
name|minecraft
operator|.
name|level
operator|!=
literal|null
condition|)
block|{
comment|// Change waterLevel after level loading
name|minecraft
operator|.
name|level
operator|.
name|waterLevel
operator|=
name|sideLevel
expr_stmt|;
block|}
else|else
block|{
comment|// Change waterLevel during level loading
name|newLevel
operator|.
name|waterLevel
operator|=
name|sideLevel
expr_stmt|;
block|}
if|if
condition|(
name|sideBlock
operator|>
literal|0
operator|&&
name|sideBlock
operator|<
name|Block
operator|.
name|blocks
operator|.
name|length
condition|)
block|{
name|minecraft
operator|.
name|textureManager
operator|.
name|setSideBlock
argument_list|(
name|sideBlock
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|minecraft
operator|.
name|textureManager
operator|.
name|resetSideBlock
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|edgeBlock
operator|>
literal|0
operator|&&
name|edgeBlock
operator|<
name|Block
operator|.
name|blocks
operator|.
name|length
condition|)
block|{
name|minecraft
operator|.
name|textureManager
operator|.
name|setEdgeBlock
argument_list|(
name|edgeBlock
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|minecraft
operator|.
name|textureManager
operator|.
name|resetEdgeBlock
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
name|minecraft
operator|.
name|level
operator|!=
literal|null
condition|)
block|{
name|minecraft
operator|.
name|levelRenderer
operator|.
name|refreshEnvironment
argument_list|()
expr_stmt|;
block|}
if|if
condition|(
operator|!
name|minecraft
operator|.
name|settings
operator|.
name|canServerChangeTextures
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Denied server's request to change the texture pack."
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|textureUrl
operator|.
name|length
argument_list|()
operator|>
literal|0
condition|)
block|{
name|File
name|textureDir
init|=
operator|new
name|File
argument_list|(
name|Minecraft
operator|.
name|getMinecraftDirectory
argument_list|()
argument_list|,
literal|"/skins/terrain"
argument_list|)
decl_stmt|;
if|if
condition|(
operator|!
name|textureDir
operator|.
name|exists
argument_list|()
condition|)
block|{
name|textureDir
operator|.
name|mkdirs
argument_list|()
expr_stmt|;
block|}
name|String
name|hash
init|=
name|minecraft
operator|.
name|getHash
argument_list|(
name|textureUrl
argument_list|)
decl_stmt|;
if|if
condition|(
name|hash
operator|!=
literal|null
condition|)
block|{
name|File
name|file
init|=
operator|new
name|File
argument_list|(
name|textureDir
argument_list|,
name|hash
operator|+
literal|".png"
argument_list|)
decl_stmt|;
name|BufferedImage
name|image
decl_stmt|;
if|if
condition|(
operator|!
name|file
operator|.
name|exists
argument_list|()
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Downloading texture pack "
operator|+
name|hash
operator|+
literal|" from "
operator|+
name|textureUrl
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|downloadImage
argument_list|(
operator|new
name|URL
argument_list|(
name|textureUrl
argument_list|)
argument_list|,
name|file
argument_list|)
expr_stmt|;
block|}
name|image
operator|=
name|ImageIO
operator|.
name|read
argument_list|(
name|file
argument_list|)
expr_stmt|;
if|if
condition|(
name|image
operator|.
name|getWidth
argument_list|()
operator|%
literal|16
operator|==
literal|0
operator|&&
name|image
operator|.
name|getHeight
argument_list|()
operator|%
literal|16
operator|==
literal|0
condition|)
block|{
name|minecraft
operator|.
name|textureManager
operator|.
name|setTerrainTexture
argument_list|(
name|image
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Unacceptable terrain texture dimensions: "
operator|+
name|image
operator|.
name|getWidth
argument_list|()
operator|+
literal|" x "
operator|+
name|image
operator|.
name|getHeight
argument_list|()
argument_list|)
expr_stmt|;
block|}
block|}
block|}
else|else
block|{
comment|// Reset texture to default
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Reset terrain texture to default."
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|textureManager
operator|.
name|setTerrainTexture
argument_list|(
literal|null
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|CLICK_DISTANCE
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|CLICK_DISTANCE
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ClickDistance"
argument_list|)
expr_stmt|;
block|}
name|short
name|clickDistance
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|minecraft
operator|.
name|gamemode
operator|.
name|reachDistance
operator|=
name|clickDistance
operator|/
literal|32
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|HOLD_THIS
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|HELD_BLOCK
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: HeldBlock"
argument_list|)
expr_stmt|;
block|}
name|byte
name|blockToHold
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
name|preventChange
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|boolean
name|canPreventChange
init|=
name|preventChange
operator|>
literal|0
decl_stmt|;
if|if
condition|(
name|canPreventChange
condition|)
block|{
name|GameSettings
operator|.
name|CanReplaceSlot
operator|=
literal|false
expr_stmt|;
block|}
name|minecraft
operator|.
name|player
operator|.
name|inventory
operator|.
name|selected
operator|=
literal|0
expr_stmt|;
name|minecraft
operator|.
name|player
operator|.
name|inventory
operator|.
name|replaceSlot
argument_list|(
name|Block
operator|.
name|blocks
index|[
name|blockToHold
index|]
argument_list|)
expr_stmt|;
if|if
condition|(
operator|!
name|canPreventChange
condition|)
block|{
name|GameSettings
operator|.
name|CanReplaceSlot
operator|=
literal|true
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|SET_TEXT_HOTKEY
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: TextHotKey"
argument_list|)
expr_stmt|;
name|String
name|label
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|action
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|int
name|keyCode
init|=
operator|(
name|int
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|byte
name|keyMods
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|HotKeyData
name|data
init|=
operator|new
name|HotKeyData
argument_list|(
name|label
argument_list|,
name|action
argument_list|,
name|keyCode
argument_list|,
name|keyMods
argument_list|)
decl_stmt|;
comment|//minecraft.hotKeys.add(data);
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_ADD_PLAYER_NAME
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|EXT_PLAYER_LIST_2
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ExtPlayerList"
argument_list|)
expr_stmt|;
block|}
name|short
name|nameId
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|playerName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|String
name|listName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|String
name|groupName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|byte
name|unusedRank
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|4
index|]
decl_stmt|;
name|int
name|playerIndex
init|=
operator|-
literal|1
decl_stmt|;
for|for
control|(
name|PlayerListNameData
name|b
range|:
name|minecraft
operator|.
name|playerListNameData
control|)
block|{
if|if
condition|(
name|b
operator|.
name|nameID
operator|==
name|nameId
condition|)
block|{
comment|// Already exists, update the entry.
name|playerIndex
operator|=
name|minecraft
operator|.
name|playerListNameData
operator|.
name|indexOf
argument_list|(
name|b
argument_list|)
expr_stmt|;
break|break;
block|}
block|}
if|if
condition|(
name|playerIndex
operator|==
operator|-
literal|1
condition|)
block|{
name|minecraft
operator|.
name|playerListNameData
operator|.
name|add
argument_list|(
operator|new
name|PlayerListNameData
argument_list|(
name|nameId
argument_list|,
name|playerName
argument_list|,
name|listName
argument_list|,
name|groupName
argument_list|,
name|unusedRank
argument_list|)
argument_list|)
expr_stmt|;
block|}
else|else
block|{
name|minecraft
operator|.
name|playerListNameData
operator|.
name|set
argument_list|(
name|playerIndex
argument_list|,
operator|new
name|PlayerListNameData
argument_list|(
name|nameId
argument_list|,
name|playerName
argument_list|,
name|listName
argument_list|,
name|groupName
argument_list|,
name|unusedRank
argument_list|)
argument_list|)
expr_stmt|;
block|}
name|Collections
operator|.
name|sort
argument_list|(
name|minecraft
operator|.
name|playerListNameData
argument_list|,
operator|new
name|PlayerListComparator
argument_list|()
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_ADD_ENTITY
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ExtPlayerList version 1"
argument_list|)
expr_stmt|;
name|byte
name|playerID
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|inGameName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|String
name|skinName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|handleExtAddEntity
argument_list|(
name|networkManager
argument_list|,
name|playerID
argument_list|,
name|inGameName
argument_list|,
name|skinName
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_REMOVE_PLAYER_NAME
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ExtPlayerList"
argument_list|)
expr_stmt|;
name|short
name|nameID
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|List
argument_list|<
name|PlayerListNameData
argument_list|>
name|cache
init|=
name|minecraft
operator|.
name|playerListNameData
decl_stmt|;
for|for
control|(
name|int
name|q
init|=
literal|0
init|;
name|q
operator|<
name|minecraft
operator|.
name|playerListNameData
operator|.
name|size
argument_list|()
condition|;
name|q
operator|++
control|)
block|{
if|if
condition|(
name|minecraft
operator|.
name|playerListNameData
operator|.
name|get
argument_list|(
name|q
argument_list|)
operator|.
name|nameID
operator|==
name|nameID
condition|)
block|{
name|cache
operator|.
name|remove
argument_list|(
name|q
argument_list|)
expr_stmt|;
block|}
block|}
name|minecraft
operator|.
name|playerListNameData
operator|=
name|cache
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|CUSTOM_BLOCK_SUPPORT_LEVEL
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|CUSTOM_BLOCKS
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: CustomBlocks"
argument_list|)
expr_stmt|;
block|}
name|byte
name|supportLevel
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Using CustomBlocks level "
operator|+
name|supportLevel
argument_list|)
expr_stmt|;
name|networkManager
operator|.
name|send
argument_list|(
name|PacketType
operator|.
name|CUSTOM_BLOCK_SUPPORT_LEVEL
argument_list|,
name|Constants
operator|.
name|CUSTOM_BLOCK_SUPPORT_LEVEL
argument_list|)
expr_stmt|;
name|SessionData
operator|.
name|setAllowedBlocks
argument_list|(
name|supportLevel
argument_list|)
expr_stmt|;
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|SET_BLOCK_PERMISSIONS
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|BLOCK_PERMISSIONS
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: BlockPermissions"
argument_list|)
expr_stmt|;
block|}
name|byte
name|blockType
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|byte
name|allowPlacement
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|byte
name|allowDeletion
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|Block
name|block
init|=
name|Block
operator|.
name|blocks
index|[
name|blockType
index|]
decl_stmt|;
if|if
condition|(
name|block
operator|==
literal|null
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Unknown block ID given for SetBlockPermission packet: "
operator|+
name|blockType
argument_list|)
expr_stmt|;
block|}
else|else
block|{
if|if
condition|(
name|allowPlacement
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|minecraft
operator|.
name|disallowedPlacementBlocks
operator|.
name|add
argument_list|(
name|block
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Disallowing placement of block: "
operator|+
name|BlockID
operator|.
name|findName
argument_list|(
name|blockType
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|minecraft
operator|.
name|disallowedPlacementBlocks
operator|.
name|remove
argument_list|(
name|block
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Allowing placement of block: "
operator|+
name|BlockID
operator|.
name|findName
argument_list|(
name|blockType
argument_list|)
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|allowDeletion
operator|==
literal|0
condition|)
block|{
if|if
condition|(
name|minecraft
operator|.
name|disallowedBreakingBlocks
operator|.
name|add
argument_list|(
name|block
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Disallowing deletion of block: "
operator|+
name|BlockID
operator|.
name|findName
argument_list|(
name|blockType
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|minecraft
operator|.
name|disallowedBreakingBlocks
operator|.
name|remove
argument_list|(
name|block
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logInfo
argument_list|(
literal|"Allowing deletion of block: "
operator|+
name|BlockID
operator|.
name|findName
argument_list|(
name|blockType
argument_list|)
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|CHANGE_MODEL
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|CHANGE_MODEL
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ChangeModel"
argument_list|)
expr_stmt|;
block|}
name|byte
name|playerId
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
comment|// Model names are case-insensitive
name|String
name|modelName
init|=
operator|(
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
operator|)
operator|.
name|toLowerCase
argument_list|()
decl_stmt|;
name|HumanoidMob
name|targetPlayer
decl_stmt|;
comment|//LogUtil.logInfo("CM: " + playerId + " " + modelName);
if|if
condition|(
name|playerId
operator|>=
literal|0
condition|)
block|{
comment|// Set another player's model
name|targetPlayer
operator|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerId
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Set own model
name|targetPlayer
operator|=
name|minecraft
operator|.
name|player
expr_stmt|;
block|}
if|if
condition|(
name|targetPlayer
operator|!=
literal|null
operator|&&
operator|!
name|targetPlayer
operator|.
name|getModelName
argument_list|()
operator|.
name|equals
argument_list|(
name|modelName
argument_list|)
condition|)
block|{
name|ModelManager
name|m
init|=
operator|new
name|ModelManager
argument_list|()
decl_stmt|;
if|if
condition|(
name|m
operator|.
name|getModel
argument_list|(
name|modelName
argument_list|)
operator|!=
literal|null
condition|)
block|{
name|targetPlayer
operator|.
name|setModel
argument_list|(
name|modelName
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Unknown model name given -- reset to humanoid
name|targetPlayer
operator|.
name|setModel
argument_list|(
name|Model
operator|.
name|HUMANOID
argument_list|)
expr_stmt|;
block|}
if|if
condition|(
name|targetPlayer
operator|.
name|getModelName
argument_list|()
operator|.
name|equals
argument_list|(
name|Model
operator|.
name|HUMANOID
argument_list|)
condition|)
block|{
name|targetPlayer
operator|.
name|setSkin
argument_list|(
name|targetPlayer
operator|.
name|lastHumanoidSkinName
argument_list|)
expr_stmt|;
block|}
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|ENV_SET_WEATHER_TYPE
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|ENV_WEATHER_TYPE
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: EnvWeatherType"
argument_list|)
expr_stmt|;
block|}
name|byte
name|weatherType
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
if|if
condition|(
name|weatherType
operator|==
literal|0
condition|)
block|{
name|minecraft
operator|.
name|isRaining
operator|=
literal|false
expr_stmt|;
name|minecraft
operator|.
name|isSnowing
operator|=
literal|false
expr_stmt|;
block|}
if|else if
condition|(
name|weatherType
operator|==
literal|1
condition|)
block|{
name|minecraft
operator|.
name|isRaining
operator|=
operator|!
name|minecraft
operator|.
name|isRaining
expr_stmt|;
name|minecraft
operator|.
name|isSnowing
operator|=
literal|false
expr_stmt|;
block|}
if|else if
condition|(
name|weatherType
operator|==
literal|2
condition|)
block|{
name|minecraft
operator|.
name|isSnowing
operator|=
operator|!
name|minecraft
operator|.
name|isSnowing
expr_stmt|;
name|minecraft
operator|.
name|isRaining
operator|=
literal|false
expr_stmt|;
block|}
block|}
if|else if
condition|(
name|packetType
operator|==
name|PacketType
operator|.
name|EXT_ADD_ENTITY2
condition|)
block|{
if|if
condition|(
operator|!
name|isExtEnabled
argument_list|(
name|ProtocolExtension
operator|.
name|EXT_PLAYER_LIST_2
argument_list|)
condition|)
block|{
name|LogUtil
operator|.
name|logWarning
argument_list|(
literal|"Server attempted to use unsupported extension: ExtPlayerList version 2"
argument_list|)
expr_stmt|;
block|}
comment|// "When an ExtAddEntity2 packet is received, it must be treated as the SpawnPlayer packet.
comment|// A player model must be spawned in-game at the given location, with InGameName text
comment|// drawn above it. Skin should be loaded using the given SkinName for a player name.
comment|// When client receives ExtAddEntity2 packet for an already-spawned player, a duplicate
comment|// entity must not be spawned and existing entity's position must not be changed.
comment|// Instead their InGameName and SkinName must be updated. If a negative EntityID is
comment|// given for ExtAddEntity2, client must update player's own spawn point, InGameName, and SkinName."
name|byte
name|playerID
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|0
index|]
decl_stmt|;
name|String
name|inGameName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|1
index|]
decl_stmt|;
name|String
name|skinName
init|=
operator|(
name|String
operator|)
name|packetParams
index|[
literal|2
index|]
decl_stmt|;
name|short
name|spawnX
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|3
index|]
decl_stmt|;
name|short
name|spawnY
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|4
index|]
decl_stmt|;
name|short
name|spawnZ
init|=
operator|(
name|short
operator|)
name|packetParams
index|[
literal|5
index|]
decl_stmt|;
name|byte
name|spawnYaw
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|6
index|]
decl_stmt|;
name|byte
name|spawnPitch
init|=
operator|(
name|byte
operator|)
name|packetParams
index|[
literal|7
index|]
decl_stmt|;
comment|//LogUtil.logInfo("EAE2: " + playerID + " " + inGameName + " " + skinName);
if|if
condition|(
name|playerID
operator|<
literal|0
operator|||
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerID
argument_list|)
operator|==
literal|null
condition|)
block|{
name|handleSpawnPlayer
argument_list|(
name|networkManager
argument_list|,
name|inGameName
argument_list|,
name|playerID
argument_list|,
name|spawnX
argument_list|,
name|spawnY
argument_list|,
name|spawnZ
argument_list|,
name|spawnYaw
argument_list|,
name|spawnPitch
argument_list|)
expr_stmt|;
block|}
name|handleExtAddEntity
argument_list|(
name|networkManager
argument_list|,
name|playerID
argument_list|,
name|inGameName
argument_list|,
name|skinName
argument_list|)
expr_stmt|;
block|}
block|}
specifier|private
name|void
name|handleExtAddEntity
parameter_list|(
name|NetworkManager
name|networkManager
parameter_list|,
name|byte
name|playerID
parameter_list|,
name|String
name|inGameName
parameter_list|,
name|String
name|skinName
parameter_list|)
block|{
if|if
condition|(
name|skinName
operator|!=
literal|null
condition|)
block|{
if|if
condition|(
name|playerID
operator|>=
literal|0
condition|)
block|{
name|NetworkPlayer
name|targetPlayer
init|=
name|networkManager
operator|.
name|getPlayer
argument_list|(
name|playerID
argument_list|)
decl_stmt|;
if|if
condition|(
name|targetPlayer
operator|!=
literal|null
condition|)
block|{
name|targetPlayer
operator|.
name|setSkin
argument_list|(
name|skinName
argument_list|)
expr_stmt|;
name|targetPlayer
operator|.
name|lastHumanoidSkinName
operator|=
name|skinName
expr_stmt|;
name|targetPlayer
operator|.
name|displayName
operator|=
name|inGameName
expr_stmt|;
block|}
block|}
else|else
block|{
name|minecraft
operator|.
name|player
operator|.
name|setSkin
argument_list|(
name|skinName
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|player
operator|.
name|lastHumanoidSkinName
operator|=
name|skinName
expr_stmt|;
comment|//No need to set the display name for yourself
block|}
block|}
block|}
specifier|private
name|void
name|handleSpawnPlayer
parameter_list|(
name|NetworkManager
name|networkManager
parameter_list|,
name|String
name|newPlayerName
parameter_list|,
name|byte
name|newPlayerId
parameter_list|,
name|short
name|newPlayerX
parameter_list|,
name|short
name|newPlayerY
parameter_list|,
name|short
name|newPlayerZ
parameter_list|,
name|byte
name|newPlayerXRot
parameter_list|,
name|byte
name|newPlayerYRot
parameter_list|)
block|{
if|if
condition|(
name|newPlayerId
operator|>=
literal|0
condition|)
block|{
name|newPlayerXRot
operator|=
operator|(
name|byte
operator|)
operator|(
name|newPlayerXRot
operator|+
literal|128
operator|)
expr_stmt|;
name|newPlayerY
operator|=
operator|(
name|short
operator|)
operator|(
name|newPlayerY
operator|-
literal|22
operator|)
expr_stmt|;
name|NetworkPlayer
name|newPlayer
init|=
operator|new
name|NetworkPlayer
argument_list|(
name|networkManager
operator|.
name|minecraft
argument_list|,
name|newPlayerName
argument_list|,
name|newPlayerX
argument_list|,
name|newPlayerY
argument_list|,
name|newPlayerZ
argument_list|,
name|newPlayerYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newPlayerXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
decl_stmt|;
name|networkManager
operator|.
name|addPlayer
argument_list|(
name|newPlayerId
argument_list|,
name|newPlayer
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|level
operator|.
name|addEntity
argument_list|(
name|newPlayer
argument_list|)
expr_stmt|;
block|}
else|else
block|{
comment|// Set own spawnpoint
name|minecraft
operator|.
name|level
operator|.
name|setSpawnPos
argument_list|(
name|newPlayerX
operator|/
literal|32
argument_list|,
name|newPlayerY
operator|/
literal|32
argument_list|,
name|newPlayerZ
operator|/
literal|32
argument_list|,
name|newPlayerXRot
operator|*
literal|320
operator|/
literal|256
argument_list|)
expr_stmt|;
name|minecraft
operator|.
name|player
operator|.
name|moveTo
argument_list|(
name|newPlayerX
operator|/
literal|32F
argument_list|,
name|newPlayerY
operator|/
literal|32F
argument_list|,
name|newPlayerZ
operator|/
literal|32F
argument_list|,
name|newPlayerXRot
operator|*
literal|360
operator|/
literal|256F
argument_list|,
name|newPlayerYRot
operator|*
literal|360
operator|/
literal|256F
argument_list|)
expr_stmt|;
block|}
block|}
comment|/**      * Checks whether an extension is currently enabled (and mutually supported) by this client and      * the server that we are currently connected to.      */
specifier|public
name|boolean
name|isExtEnabled
parameter_list|(
name|ProtocolExtension
name|ext
parameter_list|)
block|{
return|return
name|enabledExtensions
operator|.
name|contains
argument_list|(
name|ext
argument_list|)
return|;
block|}
specifier|public
name|ProtocolExtension
index|[]
name|listEnabledExtensions
parameter_list|()
block|{
name|ProtocolExtension
index|[]
name|extList
init|=
operator|new
name|ProtocolExtension
index|[
name|enabledExtensions
operator|.
name|size
argument_list|()
index|]
decl_stmt|;
return|return
name|enabledExtensions
operator|.
name|toArray
argument_list|(
name|extList
argument_list|)
return|;
block|}
specifier|public
name|void
name|enableExtension
parameter_list|(
name|ProtocolExtension
name|ext
parameter_list|)
block|{
name|enabledExtensions
operator|.
name|add
argument_list|(
name|ext
argument_list|)
expr_stmt|;
block|}
block|}
end_class

end_unit

